import argparse
import soccer3d
import numpy as np
from os.path import join

parser = argparse.ArgumentParser(description='Calibrate a soccer video')
parser.add_argument('--path_to_data', default='/home/krematas/Mountpoints/grail/data/Singleview/Soccer/Japan-Something-2', help='path')
parser.add_argument('--openpose_dir', default='/home/krematas/code/openpose', help='path')
opt, _ = parser.parse_known_args()


db = soccer3d.YoutubeVideo(opt.path_to_data)

import matplotlib.pyplot as plt
from matplotlib.widgets import Button

points2d = []

for i in range(db.n_frames):
    img = db.get_frame(i)
    fig, ax = plt.subplots(1, 1)
    ax.imshow(img)
    ax.axis('off')



    def onclick(event):
        # print('button=%d, x=%d, y=%d, xdata=%f, ydata=%f' %
        #       (event.button, event.x, event.y, event.xdata, event.ydata))
        x, y = event.xdata, event.ydata
        ax.plot(x, y, 'r.', ms=10)
        print(i, x, y)
        points2d.append([i, x, y])
        fig.canvas.draw()


    cid = fig.canvas.mpl_connect('button_press_event', onclick)
    figManager = plt.get_current_fig_manager()
    figManager.window.showMaximized()
    plt.show()

points2d = np.array(points2d)
np.save(join(opt.path_to_data, 'gt_ball.npy'), points2d)

import sys
sys.exit(-1)



points2d = [
[2639.164807703441 ,773.7004206788754],
[2643.3330020648004 ,773.7004206788754],
[2637.0807105227614 ,767.4481291368363],
[2632.912516161402 ,773.7004206788754],
[2626.6602246193634 ,767.4481291368363],
[2622.492030258004 ,769.532226317516],
[2618.3238358966446 ,769.532226317516],
[2612.0715443546055 ,767.4481291368363],
[2614.155641535285 ,771.6163234981957],
[2605.819252812567 ,767.4481291368363],
[2601.6510584512075 ,769.532226317516],
[2599.566961270528 ,761.1958375947975],
[2593.3146697284888 ,765.3640319561569],
[2584.9782810057704 ,763.2799347754772],
[2582.8941838250907 ,761.1958375947975],
[2576.6418922830517 ,757.0276432334381],
[2574.557795102372 ,759.1117404141178],
[2570.3896007410126 ,757.0276432334381],
[2566.221406379653 ,754.9435460527586],
[2512.0348796819826 ,754.9435460527586],
[2437.007381177515 ,759.1117404141178],
[2366.1480770344074 ,761.1958375947975],
[2366.1480770344074 ,763.2799347754772],
[2299.4569672526586 ,761.1958375947975],
[2224.429468748191 ,767.4481291368363],
[2157.7383589664423 ,767.4481291368363],
[2084.794957642655 ,765.3640319561569],
[2013.9356534995468 ,771.6163234981957],
[1943.0763493564386 ,771.6163234981957],
[1945.1604465371183 ,771.6163234981957],
[1874.3011423940102 ,775.7845178595551],
[1803.4418382509025 ,779.9527122209142],
[1736.7507284691537 ,786.2050037629533],
[1667.9755215067253 ,792.4572953049922],
[1597.1162173636171 ,796.6254896663515],
[1532.509204762548 ,802.8777812083904],
[1530.4251075818684 ,800.7936840277107],
[1467.902192161479 ,798.709586847031],
[1407.4633739217693 ,796.6254896663515],
[1338.6881669593408 ,792.4572953049922],
[1276.1652515389515 ,794.5413924856718],
[1211.5582389378824 ,798.709586847031],
[1149.035323517493 ,802.8777812083904],
[1149.035323517493 ,802.8777812083904],
[1082.3442137357442 ,804.9618783890701],
[1028.1576870380734 ,811.2141699311089],
[961.4665772563249 ,815.3823642924683],
[905.1959533779743 ,821.6346558345072],
[846.8412323189441 ,821.6346558345072],
[784.3183168985547 ,819.5505586538275],
[782.234219717875 ,819.5505586538275],
[728.0476930202042 ,819.5505586538275],
[669.6929719611742 ,815.3823642924683],
[613.4223480828236 ,819.5505586538275],
[555.0676270237934 ,823.7187530151868],
[500.8811003261226 ,829.9710445572259],
[446.69457362845174 ,827.8869473765462],
[448.7786708091314 ,829.9710445572259],
[390.42394975010143 ,825.8028501958665],
[363.3306864012659 ,825.8028501958665],
[384.17165820806235 ,827.8869473765462],
[402.9285328341791 ,829.9710445572259],
[421.6854074602961 ,834.1392389185851],
[423.7695046409758 ,829.9710445572259],
[446.69457362845174 ,836.2233360992648],
[467.5355454352482 ,840.3915304606242],
[488.3765172420449 ,846.643822002663],
[505.04929468748196 ,850.8120163640224],
[523.8061693135987 ,859.1484050867409],
[546.7312383010749 ,863.3165994481001],
[542.5630439397157 ,867.4847938094595],
[563.4040157465122 ,871.6529881708188],
[582.160890372629 ,879.9893768935374],
[598.833667818066 ,890.4098627969356],
[619.6746396248625 ,898.7462515196542],
[636.3474170702998 ,911.2508346037321],
[657.1883888770963 ,919.5872233264506],
[650.9360973350572 ,919.5872233264506],
[667.6088747804945 ,923.75541768781],
[684.2816522259316 ,923.75541768781],
[700.9544296713689 ,925.8395148684897],
[713.4590127554468 ,930.0077092298488],
[728.0476930202042 ,936.2600007718879],
[742.6363732849618 ,940.4281951332471],
[742.6363732849618 ,940.4281951332471],
[757.2250535497194 ,948.7645838559656],
[771.8137338144768 ,957.1009725786844],
[786.4024140792344 ,965.4373613014029],
[800.991094343992 ,971.6896528434418],
[813.4956774280697 ,984.1942359275197],
[826.0002605121476 ,984.1942359275197],
[826.0002605121476 ,986.2783331081994],
[826.0002605121476 ,986.2783331081994],
[838.5048435962256 ,986.2783331081994],
[851.0094266803035 ,990.4465274695585],
[859.345815403022 ,994.6147218309179],
[871.8503984870999, 998.7829161922773]]
points2d = np.array(points2d)


points2d = np.load(join(opt.path_to_data, 'gt_ball.npy'))
points2d = points2d[:, 1:]
struct = {i: 0 for i in db.frame_basenames}
for i, fname in enumerate(db.frame_basenames):
    struct[fname] = np.array([[points2d[i, 0], points2d[i, 1], points2d[i, 0], points2d[i, 1], 1.0]])

np.save(join(opt.path_to_data, 'metadata', 'ball.npy'), struct)